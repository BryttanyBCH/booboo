--- dmenu.c_	2010-02-22 19:22:43.000000000 +0300
+++ dmenu.c	2010-02-22 19:23:19.000000000 +0300
@@ -255,9 +255,9 @@ drawtext(const char *text, unsigned long
 	if(fontxft) {
 		if (!dc.xftdraw)
 			eprint("error, creating xft drawable failed");
-		XftDrawString8(dc.xftdraw, &dc.xftcolor, dc.xftfont.xft_font, x, y, (unsigned char*)buf, len);
+		XftDrawStringUtf8(dc.xftdraw, &dc.xftcolor, dc.xftfont.xft_font, x, y, (unsigned char*)buf, len);
 	} else if(dc.font.set)
-		XmbDrawString(dpy, dc.drawable, dc.font.set, dc.gc, x, y, buf, len);
+		Xutf8DrawString(dpy, dc.drawable, dc.font.set, dc.gc, x, y, buf, len);
 	else
 		XDrawString(dpy, dc.drawable, dc.gc, x, y, buf, len);
 }
@@ -694,11 +694,11 @@ setup(Bool topbar) {
 int
 textnw(const char *text, unsigned int len) {
 	if(fontxft) {
-		XftTextExtents8(dpy, dc.xftfont.xft_font, (const FcChar8*)text, len, &dc.gi);
+		XftTextExtentsUtf8(dpy, dc.xftfont.xft_font, (const FcChar8*)text, len, &dc.gi);
 		return dc.gi.width;
     } else if(dc.font.set) {
 	    XRectangle r;
-		XmbTextExtents(dc.font.set, text, len, NULL, &r);
+		Xutf8TextExtents(dc.font.set, text, len, NULL, &r);
 		return r.width;
 	}
 	return XTextWidth(dc.font.xfont, text, len);
